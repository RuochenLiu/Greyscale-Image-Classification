---
title: "Project 3"
author: "Nikita Bondarenko, Yue Gao, Ruochen Liu, Xuehan Liu, Xiaowo Sun"
date: "March 24, 2017"
output:
  pdf_document: default
  html_document: default
---

Group Member:
Nikita Bondarenko, Yue Gao, Ruochen Liu, Xuehan Liu, Xiaowo Sun


### Step 0: load libraries and specify directories
```{r}
if(!require("EBImage")){
  source("https://bioconductor.org/biocLite.R")
  biocLite("EBImage")
}

packages.used <- 
  c("gbm","caret","randomForest","plyr","xgboost","fastAdaboost","deepboost","e1071","kernlab"
  )

# check packages that need to be installed.
packages.needed=setdiff(packages.used, 
                        intersect(installed.packages()[,1], 
                                  packages.used))
# install additional packages
if(length(packages.needed)>0){
  install.packages(packages.needed, dependencies = TRUE)
}

library("caret")
library("gbm")
library("randomForest")
library("plyr")
library("xgboost")
library("fastAdaboost")
library("deepboost")
library("EBImage")
library("e1071")
library("kernlab")
source("./lib/feature.R")
source("./lib/train.R")
source("./lib/test.R")
```


```{r wkdir, eval=FALSE}
setwd("~/GitHub/spr2017-proj3-group7/doc/") 
# here replace it with your own path or manually set it in RStudio to where this rmd file is located. 
```

Provide directories for raw images. Training set and test set should be in different subfolders. 
```{r}
experiment_dir <- "../data/" # This will be modified for different data sets.
img_train_dir <- paste(experiment_dir, "raw_images/", sep="")
img_test_dir <- paste(experiment_dir, "test/", sep="")
```

###Step 1: Summary of trained models

####baseline model

GBM + 5000SIFT
```{r}
load("../output/baseline.RData")
print(baseline$bestTune)
print(mean(baseline$finalModel$train.error))
```

####other models that we have tried using HOG features
Test Errors:
GBM: 0.146
Random Forest:0.142
SVM Linear: 0.122
SVM Radial: 0.118
xgBoost: 0.136
DeepBoost: 0.15

####advanced model

Finally we decided to use SVM Linear model because of its low test error and stability.
```{r}
#load SVM here
load("../output/advanced.RData")
print(advanced$bestTune)
print(mean(advanced$finalModel$train.error))
```

### Step 2: Extract new features from test images

For our project, we construct 54 HOG features. Save the constructed features to the output subfolder.
```{r}

tm_feature_test <- system.time(feature_test <-feature(img_test_dir,export=T))
#load("./output/HOG.RData")

```

### Step 3: Make prediction 

####baseline model

Feed the baseline training model with the completely holdout testing data. 
```{r}
tm_test <- system.time(pred_test <- test(baseline, feature_test))
save(pred_test, file="./output/pred_test.RData")
```

####advanced model
```{r}
tm_test <- system.time(pred_test <- test(advanced, feature_test))
save(pred_test, file="./output/pred_test.RData")
```

### Step 4: Summarize Running Time

```{r}
cat("Time for constructing testing features=", tm_feature_test[1], "s \n")
cat("Time for making prediction=", tm_test[1], "s \n")
```

